<?xml version="1.0" encoding="UTF-8"?>
<dataflow xmlns="http://www.example.org/mml-schema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.example.org/mml-schema mml-schema.xsd ">

	<variable name="places" type="java.util.Collection">
		<body>new java.util.ArrayList();</body>
	</variable>
	
	<variable name="organizzazioni" type="java.lang.String"/>
	<variable name="placesList" type="java.util.List&lt;Message&gt;" />
	
	<httpConnector name="connector" method="GET" encoding="UTF-8"/>
	
	<connect name="c1" connector="connector" outputVar="organizzazioni" transformer="string">
		<properties>
			<property name="url">
				<value>"http://dati.trentino.it/it/storage/f/2013-05-16T105357/Registro_organizzazioni_certificate_Audit.csv"</value>
			</property>
		</properties>
	</connect>		


	<script outputVar="places" writeMethod="addAll" writeAction="append">
		<className>eu.trentorise.smartcampus.service.placesbuilder.trentinofamiglia.TrentinoFamigliaConverter</className>
		<method>readOrganizzazioni</method>
		<variables>
			<value>organizzazioni</value>
		</variables>	
	</script>

	<foreach name="fe1" item="place" itemClass="smartcampus.service.placesbuilder.data.message.Placesbuilder.Place" aggregateVariable="placesList" outputVar="output" writeAction="append" writeMethod="addAll">
		<items>places</items>
		
		<geolocalize outputVar="placesList" inputVar="place" writeAction="append" attribute="poi" onError="continue">
        	<poiName>place.getName()</poiName>
      	</geolocalize>				
		
		
	</foreach>

</dataflow>
